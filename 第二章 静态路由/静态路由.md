> 有理想、有抱负，相信在不久的将来，你会成功的！

> 打开微信搜索【孩子上学后】，关注这个不一样的程序员。

> [TOC](目录)

# 一 、 网关

## 1.1 概述

对于一台使用TCP/IP协议连接到网络的一台主机来说，要想成功的与其他网络连接通信，TCP/IP就必须了解三信息

- IP地址
- 默认网关
- 子网掩码

![image-20201108134652625](https://static-router.oss-cn-beijing.aliyuncs.com/image-20201108134652625.png)

如上图所示，你会看到三个重要的信息：ipv4地址、子网掩码、默认网关；在同一子网下 默认网关和子网掩码是一样的。

## 1.2 网关

网关就是一个网络连接到另一个网络的“关口”。它实质上是一个网络通向另外网络的ip地址。不同网络之间的接口。从一个网络到另一个网络的转发点。

## 1.3 默认网关

对于不在同一网络的ip地址，想要互相通信，就必须依赖网关。这个功能是由**路由器**，即三层设备来完成。

默认网关：就像一个房间有多扇门一样，一台主机可以有多个网关，默认网关是指一台主机如果找不到一台可以用的网关，就会把数据包发送给默认网关。

## 1.4 网关的值

网关的值一般是取本网段的最后一个ip地址。

# 二、mac、ip、port三类地址

想要数据在网络中可以正常的通信，那么有三个地址是必不可少的。

- 端口号
- ip地址
- mac地址

## 2.1 端口号

端口号的作用是让应用层的各种应用进程都能将其数据通过端口向下交付给传输层，以及让传输层知道应当将其报文段中的数据向上传送给应用层的每个应用进程。从这个意义上讲，每一个端口就相当于每一个应用进程。

**注意事项**

- 端口号用一个16bit端口号进行标志。
- 端口号只具有本地意义，即端口号只是标志本地计算机应用层的各个进程。在英特网中不同计算机相同端口号是没有任何关联的。

一般来说，端口号大致分三类：

- 公认端口：0~1023，它们紧密绑定于一些服务。通常这些端口通讯明确表明了某种服务的协议。例如80端口是http协议（超文本传输协议）通信。
- 注册端口：1024~49151。它们松散绑定于一些服务。也就是许多服务绑定了这些端口，例如：许多系统处理动态端口从1024左右开始。
- 动态端口或者是私有端口：从49152到65535。理论上，不应该为服务分配这些端口。实际上机器从1024起开始分配动态端口。

## 2.2 常见端口号介绍

![02](https://static-router.oss-cn-beijing.aliyuncs.com/02.png)

21	FTP传输协议

23	Telnet远程登录

25	SMTP简单文件传输协议

53	DNS域名解析协议

80	HTTP超文本传输协议

119	NNTP网络新闻传输协议

161	SNMP简单网络管理协议

8000、8001	QQ服务器端口

## 2.3 MAC地址

网络上的设备有一个唯一地址---MAC地址，也叫物理地址，也叫网卡地址。

MAC地址由48bit组成，通常由12位16进制表示

前6位16进制数字通常由IEEE负责统一分发，用来确定厂商的唯一性

后6位16进制数字由各厂商自行管理

**查看MAC地址**

![04](https://static-router.oss-cn-beijing.aliyuncs.com/04.png)

## 2.4 IP地址

IP地址工作在网络层，完成数据包寻址

![06](https://static-router.oss-cn-beijing.aliyuncs.com/06.png)

## 2.5 物理地址vs逻辑（IP）地址

**物理地址**

- 固化在物理设备上
- 每个端口仅有一个物理地址
- 访问物理介质时使用

**网络地址（ip地址）**

在软件系统中设定

每个端口号可有多个网络地址

网间寻址时使用。

# 三、路由器

在互联网中进行路由选择所使用的设备，或者说实现路由的设备，我们称之为路由器。

路由器关键功能：

- 检查数据包的目的地

- 确定信息源

- 发现可能的路由

- 选择最佳的路由

- 验证和维护路由信息

## 3.1 什么是路由

路由是指导IP报文发送的路劲信息

![05](https://static-router.oss-cn-beijing.aliyuncs.com/05.png)

## 3.2 路由表

路由器工作时依赖于路由表进行数据转发。路由表相当于一张地图，它包含着去往各个路由的信息，每条信息至少包含三个内容：

- 目的网络：表明路由器可以到达的网络地址，可以理解为去哪里
- 下一跳：通常情况下，下一跳一般指向去往目的网络的下一个路由器的接口地址，称之为下一跳路由器。
- 出接口：表明数据包从本路由器的哪个接口发送出去。

## 3.3 静态路由和动态路由

静态路由的选择算法是一种非自适应路由选择算法，这是一种不可测量、不利用网络状态信息，仅仅按照某种固定的规律进行决策的简单路由算法，依靠手工输入信息来配置路由表。静态路由在默认状态下是私有的，因此，安全性高。

**静态路由**

- 由网络管理员手工指定的路由
- 当网络拓扑发生变化时，需要管理员手工更新静态路由

**动态路由**

- 路由器使用路由协议从其他路由器那获悉的路由
- 当网络拓扑发生变化时，路由器会更新路由信息

# 四、静态路由的配置实例

在配置之前先说明一个问题：本次配置案例使用的是华为的仿真模拟器Ensp，当开启设备的时候可能会出现如下图所示的错误

![image-20201108123840400](https://static-router.oss-cn-beijing.aliyuncs.com/image-20201108123840400.png)

这个问题的解决方法是，点击路由设备-->右键-->设置

将串口号改为9600、9601、9602等以此类推，如下图所示

![](https://static-router.oss-cn-beijing.aliyuncs.com/image-20201108124027860.png)





![路由器配置](https://static-router.oss-cn-beijing.aliyuncs.com/image-20201108092142121.png)

案例描述：

如图所示：三台router路由器相连。

实验要求：配置路由的名字、地址和静态路由，使得PC1能够和PC2通信。

端口地址如上图所示。

**说明：在路由器R1的配置中，由于192.168.1.0网段和192.168.2.0网段与R1直接相连，因此不需要配置在静态路由表中，而192.168.3.0网段和192.168.4.0网段不与R1直接相连，因此需要配置在静态路由表中。**

对于其他的路由器配置也是这个道理。

`示例1：配置R1`

```
system-view	# 进入系统模式
undo info-center enable # 关闭提示信息
interface g0/0/0	# 切换到GE0/0/0这个端口
ip address 192.168.1.254 24	# 配置GE0/0/0这个端口的ip地址
inter g0/0/1	# 切换到GE0/0/1这个端口
ip address 192.168.2.1 24	# 配置GE0/0/1这个端口的ip地址
quit	# 回到系统模式
ip route-static 192.168.3.0 24 192.168.2.2	# 配置静态路由
ip route-static 192.168.4.0 24 192.168.2.2	# 配置静态路由
```

最后两行命令，我在这里做一些简单的说明，在这两行命令中，你会看到这里存在3组数据：

- 192.168.3.0/192.168.4.0

  说明从R1到`190.168.3.0网段/190.168.3.0网段`

- 24

  说明这是个完整的子网掩码，并没有被划分

- 192.168.2.2

  说明从R1到`190.168.3.0网段/190.168.3.0网段`的下一跳是192.168.2.2，也可以理解为网关

`示例2：配置R2`

```
system-view	# 进入系统模式
undo info-center enable # 关闭提示信息
interface g0/0/0	# 切换到GE0/0/0这个端口
ip address 192.168.2.2 24	# 配置GE0/0/0这个端口的ip地址
inter g0/0/1	# 切换到GE0/0/1这个端口
ip address 192.168.3.1 24	# 配置GE0/0/1这个端口的ip地址
quit	# 回到系统模式
ip route-static 192.168.1.0 24 192.168.2.1	# 配置静态路由
ip route-static 192.168.4.0 24 192.168.3.2	# 配置静态路由
```

到这一步就要注意两点：

1、当R2想要前往192.168.1.0网段的时候，下一跳(网关)是192.168.2.1。

2、当R2想要前往192.168.4.0网段的时候，下一跳(网关)是192.168.3.2。

3、在R1的时候配置了去往192.168.3.0的网段，在R2的时候不要忘记回来192.168.1.0网段。



在路由通信过程中，需要发送请求包，如果通信正常会返回通信的延时信息，也就是响应信息。否则可能出现两种情况：

1、主机地址不可达。错误原因：未配置ip地址

2、请求超时（time out）。 错误原因：只配置去的路由，没有配置回来的路由。



配置至此，从pc1到192.168.3.1这个ip地址都是可以正常访问的，现在来做一个简单的测试，在测试之前，需要先配置pc1

如下图所示：

![image-20201108132636135](https://static-router.oss-cn-beijing.aliyuncs.com/image-20201108132636135.png)

注意荧光部分，你会发现，网关地址与R1的GE0/0/0的IP地址是一样的，也就是GE0/0/0这个端口就是PC1的网关。PC2也是同样的道理！

![image-20201108133102503](https://static-router.oss-cn-beijing.aliyuncs.com/image-20201108133102503.png)



从上图你会发现，PC1成功访问了192.168.3.1这个IP地址。

`示例3：配置R3`

```
system-view	# 进入系统模式
undo info-center enable # 关闭提示信息
interface g0/0/0	# 切换到GE0/0/0这个端口
ip address 192.168.3.2 24	# 配置GE0/0/0这个端口的ip地址
inter g0/0/1	# 切换到GE0/0/1这个端口
ip address 192.168.4.254 24	# 配置GE0/0/1这个端口的ip地址
quit	# 回到系统模式
ip route-static 192.168.1.0 24 192.168.3.1	# 配置静态路由
ip route-static 192.168.2.0 24 192.168.3.1	# 配置静态路由
```



最后一步就是将PC2配置完成就结束了，PC2配置信息如下图所示

![image-20201108133832090](https://static-router.oss-cn-beijing.aliyuncs.com/image-20201108133832090.png)



接下来，就来测试一下PC1到PC2是否实现了通信，测试结果如下图所示：

![image-20201108134003047](https://static-router.oss-cn-beijing.aliyuncs.com/image-20201108134003047.png)

没有出现任何问题，说明静态路由就配置成功了！

你学会了吗？

# 最后

本次关于静态路由配置的内容到这里就完美收官了。本次案例是有用的是华为模拟器ensp，官网已经下架，如需获取该工具，打开微信搜索【孩子上学后】，回复【ensp】即可获取。

路漫漫其修远兮，吾将上下而求索！

我是**啃书君**，一个专注于学习的人，**你懂的越多，你不懂的越多**。

更多精彩内容我们下期再见！